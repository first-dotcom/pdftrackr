{
  "version": "5",
  "dialect": "postgresql",
  "id": "0004_analytics_indexes",
  "prevId": "0003_add_page_count",
  "tables": {
    "analytics_summary": {
      "name": "analytics_summary",
      "schema": "",
      "columns": {
        "avgDuration": {
          "name": "avg_duration",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "countries": {
          "name": "countries",
          "type": "json"
        },
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "date": {
          "name": "date",
          "type": "varchar(10)",
          "notNull": true
        },
        "devices": {
          "name": "devices",
          "type": "json"
        },
        "emailCaptures": {
          "name": "email_captures",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "fileId": {
          "name": "file_id",
          "type": "integer",
          "notNull": true,
          "references": {
            "table": "files",
            "column": "id",
            "onDelete": "cascade"
          }
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "referers": {
          "name": "referers",
          "type": "json"
        },
        "totalDuration": {
          "name": "total_duration",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "totalViews": {
          "name": "total_views",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "uniqueViews": {
          "name": "unique_views",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "updatedAt": {
          "name": "updated_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "analytics_summary_file_id_date_idx": {
          "name": "analytics_summary_file_id_date_idx",
          "columns": [
            "fileId",
            "date"
          ],
          "isUnique": true
        },
        "analytics_summary_date_idx": {
          "name": "analytics_summary_date_idx",
          "columns": [
            "date"
          ]
        }
      },
      "foreignKeys": {
        "analytics_summary_file_id_files_id_fk": {
          "name": "analytics_summary_file_id_files_id_fk",
          "tableFrom": "analytics_summary",
          "tableTo": "files",
          "columnsFrom": [
            "fileId"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "audit_logs": {
      "name": "audit_logs",
      "schema": "",
      "columns": {
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "event": {
          "name": "event",
          "type": "varchar(50)",
          "notNull": true
        },
        "fileId": {
          "name": "file_id",
          "type": "varchar(255)"
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "ipAddress": {
          "name": "ip_address",
          "type": "varchar(45)"
        },
        "metadata": {
          "name": "metadata",
          "type": "json"
        },
        "shareId": {
          "name": "share_id",
          "type": "varchar(255)"
        },
        "success": {
          "name": "success",
          "type": "boolean",
          "notNull": true,
          "default": true
        },
        "userId": {
          "name": "user_id",
          "type": "varchar(255)"
        },
        "userAgent": {
          "name": "user_agent",
          "type": "text"
        }
      },
      "indexes": {
        "audit_logs_event_idx": {
          "name": "audit_logs_event_idx",
          "columns": [
            "event"
          ]
        },
        "audit_logs_file_id_idx": {
          "name": "audit_logs_file_id_idx",
          "columns": [
            "fileId"
          ]
        },
        "audit_logs_share_id_idx": {
          "name": "audit_logs_share_id_idx",
          "columns": [
            "shareId"
          ]
        },
        "audit_logs_timestamp_idx": {
          "name": "audit_logs_timestamp_idx",
          "columns": [
            "createdAt"
          ]
        }
      }
    },
    "email_captures": {
      "name": "email_captures",
      "schema": "",
      "columns": {
        "capturedAt": {
          "name": "captured_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "notNull": true
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "ipAddress": {
          "name": "ip_address",
          "type": "varchar(45)"
        },
        "name": {
          "name": "name",
          "type": "varchar(255)"
        },
        "referer": {
          "name": "referer",
          "type": "text"
        },
        "shareId": {
          "name": "share_id",
          "type": "varchar(50)",
          "notNull": true,
          "references": {
            "table": "share_links",
            "column": "shareId",
            "onDelete": "cascade"
          }
        },
        "userAgent": {
          "name": "user_agent",
          "type": "text"
        }
      },
      "indexes": {
        "email_captures_captured_at_idx": {
          "name": "email_captures_captured_at_idx",
          "columns": [
            "capturedAt"
          ]
        },
        "email_captures_email_idx": {
          "name": "email_captures_email_idx",
          "columns": [
            "email"
          ]
        },
        "email_captures_share_id_idx": {
          "name": "email_captures_share_id_idx",
          "columns": [
            "shareId"
          ]
        }
      },
      "foreignKeys": {
        "email_captures_share_id_share_links_share_id_fk": {
          "name": "email_captures_share_id_share_links_share_id_fk",
          "tableFrom": "email_captures",
          "tableTo": "share_links",
          "columnsFrom": [
            "shareId"
          ],
          "columnsTo": [
            "shareId"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "files": {
      "name": "files",
      "schema": "",
      "columns": {
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "fileName": {
          "name": "file_name",
          "type": "varchar(255)",
          "notNull": true
        },
        "filePath": {
          "name": "file_path",
          "type": "varchar(500)",
          "notNull": true
        },
        "fileType": {
          "name": "file_type",
          "type": "varchar(50)",
          "notNull": true
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "pageCount": {
          "name": "page_count",
          "type": "integer"
        },
        "scanStatus": {
          "name": "scan_status",
          "type": "varchar(50)",
          "default": "pending"
        },
        "securityFlags": {
          "name": "security_flags",
          "type": "json"
        },
        "size": {
          "name": "size",
          "type": "bigint",
          "notNull": true
        },
        "updatedAt": {
          "name": "updated_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "userId": {
          "name": "user_id",
          "type": "varchar(255)",
          "notNull": true,
          "references": {
            "table": "users",
            "column": "id",
            "onDelete": "cascade"
          }
        }
      },
      "indexes": {
        "files_page_count_idx": {
          "name": "files_page_count_idx",
          "columns": [
            "pageCount"
          ]
        },
        "files_user_id_idx": {
          "name": "files_user_id_idx",
          "columns": [
            "userId"
          ]
        }
      },
      "foreignKeys": {
        "files_user_id_users_id_fk": {
          "name": "files_user_id_users_id_fk",
          "tableFrom": "files",
          "tableTo": "users",
          "columnsFrom": [
            "userId"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "page_views": {
      "name": "page_views",
      "schema": "",
      "columns": {
        "duration": {
          "name": "duration",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "pageNumber": {
          "name": "page_number",
          "type": "integer",
          "notNull": true
        },
        "scrollDepth": {
          "name": "scroll_depth",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "sessionId": {
          "name": "session_id",
          "type": "uuid",
          "notNull": true,
          "references": {
            "table": "view_sessions",
            "column": "sessionId",
            "onDelete": "cascade"
          }
        },
        "viewedAt": {
          "name": "viewed_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "page_views_page_number_idx": {
          "name": "page_views_page_number_idx",
          "columns": [
            "pageNumber"
          ]
        },
        "page_views_session_id_idx": {
          "name": "page_views_session_id_idx",
          "columns": [
            "sessionId"
          ]
        },
        "page_views_viewed_at_idx": {
          "name": "page_views_viewed_at_idx",
          "columns": [
            "viewedAt"
          ]
        }
      },
      "foreignKeys": {
        "page_views_session_id_view_sessions_session_id_fk": {
          "name": "page_views_session_id_view_sessions_session_id_fk",
          "tableFrom": "page_views",
          "tableTo": "view_sessions",
          "columnsFrom": [
            "sessionId"
          ],
          "columnsTo": [
            "sessionId"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "share_links": {
      "name": "share_links",
      "schema": "",
      "columns": {
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "downloadEnabled": {
          "name": "download_enabled",
          "type": "boolean",
          "notNull": true,
          "default": false
        },
        "emailGatingEnabled": {
          "name": "email_gating_enabled",
          "type": "boolean",
          "notNull": true,
          "default": false
        },
        "expiresAt": {
          "name": "expires_at",
          "type": "timestamp"
        },
        "fileId": {
          "name": "file_id",
          "type": "integer",
          "notNull": true,
          "references": {
            "table": "files",
            "column": "id",
            "onDelete": "cascade"
          }
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "isActive": {
          "name": "is_active",
          "type": "boolean",
          "notNull": true,
          "default": true
        },
        "maxViews": {
          "name": "max_views",
          "type": "integer"
        },
        "password": {
          "name": "password",
          "type": "varchar(255)"
        },
        "shareId": {
          "name": "share_id",
          "type": "varchar(50)",
          "notNull": true,
          "unique": true
        },
        "title": {
          "name": "title",
          "type": "varchar(255)"
        },
        "updatedAt": {
          "name": "updated_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "watermarkEnabled": {
          "name": "watermark_enabled",
          "type": "boolean",
          "notNull": true,
          "default": false
        }
      },
      "indexes": {
        "share_links_expires_at_idx": {
          "name": "share_links_expires_at_idx",
          "columns": [
            "expiresAt"
          ]
        },
        "share_links_file_id_idx": {
          "name": "share_links_file_id_idx",
          "columns": [
            "fileId"
          ]
        },
        "share_links_share_id_idx": {
          "name": "share_links_share_id_idx",
          "columns": [
            "shareId"
          ],
          "isUnique": true
        }
      },
      "foreignKeys": {
        "share_links_file_id_files_id_fk": {
          "name": "share_links_file_id_files_id_fk",
          "tableFrom": "share_links",
          "tableTo": "files",
          "columnsFrom": [
            "fileId"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "users": {
      "name": "users",
      "schema": "",
      "columns": {
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "notNull": true,
          "unique": true
        },
        "id": {
          "name": "id",
          "type": "varchar(255)",
          "notNull": true,
          "primaryKey": true
        },
        "name": {
          "name": "name",
          "type": "varchar(255)"
        },
        "plan": {
          "name": "plan",
          "type": "varchar(50)",
          "notNull": true,
          "default": "free"
        },
        "updatedAt": {
          "name": "updated_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "users_email_idx": {
          "name": "users_email_idx",
          "columns": [
            "email"
          ],
          "isUnique": true
        }
      }
    },
    "view_sessions": {
      "name": "view_sessions",
      "schema": "",
      "columns": {
        "browser": {
          "name": "browser",
          "type": "varchar(50)"
        },
        "city": {
          "name": "city",
          "type": "varchar(100)"
        },
        "consentGiven": {
          "name": "consent_given",
          "type": "boolean",
          "notNull": true,
          "default": false
        },
        "country": {
          "name": "country",
          "type": "varchar(2)"
        },
        "dataRetentionDate": {
          "name": "data_retention_date",
          "type": "timestamp"
        },
        "device": {
          "name": "device",
          "type": "varchar(50)"
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "ipAddressHash": {
          "name": "ip_address_hash",
          "type": "varchar(64)"
        },
        "ipAddressCountry": {
          "name": "ip_address_country",
          "type": "varchar(2)"
        },
        "isUnique": {
          "name": "is_unique",
          "type": "boolean",
          "notNull": true,
          "default": true
        },
        "lastActiveAt": {
          "name": "last_active_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "os": {
          "name": "os",
          "type": "varchar(50)"
        },
        "referer": {
          "name": "referer",
          "type": "text"
        },
        "riskScore": {
          "name": "risk_score",
          "type": "integer",
          "default": 0
        },
        "sessionId": {
          "name": "session_id",
          "type": "uuid",
          "notNull": true,
          "unique": true
        },
        "shareId": {
          "name": "share_id",
          "type": "varchar(50)",
          "notNull": true,
          "references": {
            "table": "share_links",
            "column": "shareId",
            "onDelete": "cascade"
          }
        },
        "startedAt": {
          "name": "started_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "suspiciousFlags": {
          "name": "suspicious_flags",
          "type": "json"
        },
        "totalDuration": {
          "name": "total_duration",
          "type": "integer",
          "notNull": true,
          "default": 0
        },
        "userAgent": {
          "name": "user_agent",
          "type": "text"
        },
        "viewerEmail": {
          "name": "viewer_email",
          "type": "varchar(255)"
        },
        "viewerName": {
          "name": "viewer_name",
          "type": "varchar(255)"
        }
      },
      "indexes": {
        "view_sessions_ip_hash_idx": {
          "name": "view_sessions_ip_hash_idx",
          "columns": [
            "ipAddressHash"
          ]
        },
        "view_sessions_retention_idx": {
          "name": "view_sessions_retention_idx",
          "columns": [
            "dataRetentionDate"
          ]
        },
        "view_sessions_risk_idx": {
          "name": "view_sessions_risk_idx",
          "columns": [
            "riskScore"
          ]
        },
        "view_sessions_session_id_idx": {
          "name": "view_sessions_session_id_idx",
          "columns": [
            "sessionId"
          ],
          "isUnique": true
        },
        "view_sessions_share_id_idx": {
          "name": "view_sessions_share_id_idx",
          "columns": [
            "shareId"
          ]
        },
        "view_sessions_started_at_idx": {
          "name": "view_sessions_started_at_idx",
          "columns": [
            "startedAt"
          ]
        }
      },
      "foreignKeys": {
        "view_sessions_share_id_share_links_share_id_fk": {
          "name": "view_sessions_share_id_share_links_share_id_fk",
          "tableFrom": "view_sessions",
          "tableTo": "share_links",
          "columnsFrom": [
            "shareId"
          ],
          "columnsTo": [
            "shareId"
          ],
          "onDelete": "cascade"
        }
      }
    },
    "waitlist": {
      "name": "waitlist",
      "schema": "",
      "columns": {
        "createdAt": {
          "name": "created_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "email": {
          "name": "email",
          "type": "varchar(255)",
          "notNull": true,
          "unique": true
        },
        "id": {
          "name": "id",
          "type": "serial",
          "notNull": true,
          "primaryKey": true
        },
        "ipAddress": {
          "name": "ip_address",
          "type": "varchar(45)"
        },
        "plan": {
          "name": "plan",
          "type": "varchar(20)",
          "notNull": true
        },
        "referer": {
          "name": "referer",
          "type": "varchar(500)"
        },
        "source": {
          "name": "source",
          "type": "varchar(100)"
        },
        "updatedAt": {
          "name": "updated_at",
          "type": "timestamp",
          "notNull": true,
          "default": "now()"
        },
        "userAgent": {
          "name": "user_agent",
          "type": "text"
        }
      },
      "indexes": {
        "waitlist_created_at_idx": {
          "name": "waitlist_created_at_idx",
          "columns": [
            "createdAt"
          ]
        },
        "waitlist_email_idx": {
          "name": "waitlist_email_idx",
          "columns": [
            "email"
          ],
          "isUnique": true
        },
        "waitlist_plan_idx": {
          "name": "waitlist_plan_idx",
          "columns": [
            "plan"
          ]
        }
      }
    }
  },
  "relations": {
    "analytics_summary": {
      "file": {
        "type": "one",
        "tableFrom": "analytics_summary",
        "tableTo": "files",
        "columnsFrom": [
          "fileId"
        ],
        "columnsTo": [
          "id"
        ]
      }
    },
    "files": {
      "analyticsSummary": {
        "type": "many",
        "tableFrom": "files",
        "tableTo": "analytics_summary",
        "columnsFrom": [
          "id"
        ],
        "columnsTo": [
          "fileId"
        ]
      },
      "shareLinks": {
        "type": "many",
        "tableFrom": "files",
        "tableTo": "share_links",
        "columnsFrom": [
          "id"
        ],
        "columnsTo": [
          "fileId"
        ]
      },
      "user": {
        "type": "one",
        "tableFrom": "files",
        "tableTo": "users",
        "columnsFrom": [
          "userId"
        ],
        "columnsTo": [
          "id"
        ]
      }
    },
    "page_views": {
      "session": {
        "type": "one",
        "tableFrom": "page_views",
        "tableTo": "view_sessions",
        "columnsFrom": [
          "sessionId"
        ],
        "columnsTo": [
          "sessionId"
        ]
      }
    },
    "share_links": {
      "emailCaptures": {
        "type": "many",
        "tableFrom": "share_links",
        "tableTo": "email_captures",
        "columnsFrom": [
          "shareId"
        ],
        "columnsTo": [
          "shareId"
        ]
      },
      "file": {
        "type": "one",
        "tableFrom": "share_links",
        "tableTo": "files",
        "columnsFrom": [
          "fileId"
        ],
        "columnsTo": [
          "id"
        ]
      },
      "viewSessions": {
        "type": "many",
        "tableFrom": "share_links",
        "tableTo": "view_sessions",
        "columnsFrom": [
          "shareId"
        ],
        "columnsTo": [
          "shareId"
        ]
      }
    },
    "users": {
      "files": {
        "type": "many",
        "tableFrom": "users",
        "tableTo": "files",
        "columnsFrom": [
          "id"
        ],
        "columnsTo": [
          "userId"
        ]
      }
    },
    "view_sessions": {
      "pageViews": {
        "type": "many",
        "tableFrom": "view_sessions",
        "tableTo": "page_views",
        "columnsFrom": [
          "sessionId"
        ],
        "columnsTo": [
          "sessionId"
        ]
      },
      "shareLink": {
        "type": "one",
        "tableFrom": "view_sessions",
        "tableTo": "share_links",
        "columnsFrom": [
          "shareId"
        ],
        "columnsTo": [
          "shareId"
        ]
      }
    }
  }
}
